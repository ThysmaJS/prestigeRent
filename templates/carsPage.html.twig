{% include 'partials/_navbar.html.twig' %}


{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location de Voitures</title>
</head>
<body class="bg-gray-100">

    <main class="container mx-auto my-8">
    <div class="flex justify-between items-center mb-8">
<div class="flex justify-center gap-4">
    <a href="{{ path('filterCars', {'type': 'berline'}) }}" class="flex flex-col items-center mx-5">
        <img src="{{ asset('../assets/images/berline_bar.png') }}" alt="Berline" class="w-24 h-auto">
        <span class="mt-2">Berline</span>
    </a>
    <a href="{{ path('filterCars', {'type': 'citadine'}) }}" class="flex flex-col items-center mx-5">
        <img src="{{ asset('../assets/images/citadine_bar.png') }}" alt="Citadine" class="w-24 h-auto">
        <span class="image-alt">Citadine</span>
    </a>
    <a href="{{ path('filterCars', {'type': 'collection'}) }}" class="flex flex-col items-center mx-5">
        <img src="{{ asset('../assets/images/collection_bar.png') }}" alt="Collection" class="w-24 h-auto">
        <span class="image-alt">Collection</span>
    </a>
    <a href="{{ path('filterCars', {'type': 'coupe'}) }}" class="flex flex-col items-center mx-5">
        <img src="{{ asset('../assets/images/coupe_bar.png') }}" alt="Coupe" class="w-24 h-auto">
        <span class="image-alt">Coupe</span>
    </a>
    <a href="{{ path('filterCars', {'type': 'limousine'}) }}" class="flex flex-col items-center mx-5">
        <img src="{{ asset('../assets/images/limousine_bar.png') }}" alt="Limousine" class="w-24 h-auto">
        <span class="image-alt">Limousine</span>
    </a>
    <a href="{{ path('filterCars', {'type': 'sportive'}) }}" class="flex flex-col items-center mx-5">
        <img src="{{ asset('../assets/images/sportive_bar.png') }}" alt="Sportive" class="w-24 h-auto">
        <span class="image-alt">Sportive</span>
    </a>
    <a href="{{ path('filterCars', {'type': 'tout_terrain'}) }}" class="flex flex-col items-center mx-5">
        <img src="{{ asset('../assets/images/tout_terrain_bar.png') }}" alt="Tout terrain" class="w-24 h-auto">
        <span class="image-alt">Tout terrain</span>
    </a>
    </div>
<div class="boutonReset">
        <button type="button" onclick="resetFilters()" class="right-0 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg mt-4 col-span-2">Réinitialiser les filtres</button>
</div>
</div>

            <hr class="border-t border-gray-400">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 mt-8">
<form action="{{ path('filterCars') }}" method="get" class="grid grid-cols-1 sm:grid-cols-2 gap-4 bg-gray-100 p-4 rounded-lg">
    <!-- Filtre par nombre de portes -->
    <div>
        <h2 class="text-lg font-semibold mb-2">Nombre de portes</h2>
        <div class="flex items-center space-x-2">
            <input type="checkbox" name="doors" value="3" id="doors_3" class="form-checkbox rounded text-blue-500">
            <label for="doors_3">3 portes</label>
        </div>
        <div class="flex items-center space-x-2 mt-2">
            <input type="checkbox" name="doors" value="5" id="doors_5" class="form-checkbox rounded text-blue-500">
            <label for="doors_5">5 portes</label>
        </div>
    </div>

    <!-- Filtre par type de moteur -->
    <div>
        <h2 class="text-lg font-semibold mb-2">Type de moteur</h2>
        <div class="flex items-center space-x-2">
            <input type="checkbox" name="engineTypes" value="Diesel" id="engineType_diesel" class="form-checkbox rounded text-blue-500">
            <label for="engineType_diesel">Diesel</label>
        </div>
        <div class="flex items-center space-x-2 mt-2">
            <input type="checkbox" name="engineTypes" value="Essence" id="engineType_essence" class="form-checkbox rounded text-blue-500">
            <label for="engineType_essence">Essence</label>
        </div>
        <div class="flex items-center space-x-2 mt-2">
            <input type="checkbox" name="engineTypes" value="Electrique" id="engineType_electrique" class="form-checkbox rounded text-blue-500">
            <label for="engineType_electrique">Électrique</label>
        </div>
    </div>

    <!-- Filtre par kilométrage -->
    <div>
        <h2 class="text-lg font-semibold mb-2">Kilométrage</h2>
        <div class="flex items-center space-x-2">
            <label for="minKilometer" class="w-24"></label>
            <input type="number" name="minKilometer" id="minKilometer" placeholder="Min" class="form-input rounded-lg border border-gray-300 px-2 py-1">
        </div>
        <div class="flex items-center space-x-2 mt-2">
            <label for="maxKilometer" class="w-22"></label>
            <input type="number" name="maxKilometer" id="maxKilometer" placeholder="Max" class="form-input rounded-lg border border-gray-300 px-2 py-1">
        </div>
    </div>

    <!-- Bouton de soumission -->
    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg mt-4 col-span-2">Filtrer</button>
</form>
        {% for car in cars %}
        <div class="bg-white shadow-md rounded-md overflow-hidden transition transform hover:-translate-y-1 hover:shadow-lg relative">
            <a href="{{ path('carDetails', {'id': car.id}) }}" class="block">
                {% if car.images|length > 0 %}
                <img src="{{ asset('images/' ~ car.images[0].imagePath) }}" alt="{{ car.title }}" class="w-full h-48 object-cover">
                {% else %}
                <img src="{{ asset('../assets/images/default_car_image.png') }}" alt="Image par défaut" class="w-full h-48 object-cover">
                {% endif %}
            </a>
            <div class="p-4">
                <h3 class="text-xl font-semibold text-gray-800">{{ car.title }}</h3>
                <p class="text-gray-600">{{ car.description }}</p>
                <p class="text-green-600 font-semibold mt-2">Prix: {{ car.price }} €</p>
            </div>
            <!-- Bouton pour ajouter aux favoris -->
<button class="heart-button absolute top-2 right-2 bg-white rounded-full p-2 shadow-md hover:bg-gray-200 focus:outline-none" data-car-id="{{ car.id }}">
    <!-- Icône de cœur -->
    {% if car.id in app.session.get('favoriteCarIds', []) %}
        <img src="{{ asset('../assets/images/coeurPlein.png') }}" alt="Coeur plein" class="w-6 h-6">
    {% else %}
        <img src="{{ asset('../assets/images/coeurVide.png') }}" alt="Coeur vide" class="w-6 h-6">
    {% endif %}
</button>
        </div>
        {% endfor %}
    </div>
    </main>

    <footer class="bg-gray-800 text-white py-4">
        <div class="container mx-auto text-center">
            <p>&copy; 2024 Location de Voitures. Tous droits réservés.</p>
        </div>
    </footer>
</body>
</html>
<script>
    // Définir les chemins vers l'ajout et la suppression des favoris
    var addToFavoritesUrl = "{{ path('add_to_favorites', {'id': 'CAR_ID'}) }}";
    var removeFromFavoritesUrl = "{{ path('remove_from_favorites', {'id': 'CAR_ID'}) }}";

    // Fonction pour réinitialiser les filtres
    function resetFilters() {
        window.location.href = window.location.pathname;
    }

    // Sélectionnez tous les boutons avec la classe "heart-button"
    var heartButtons = document.querySelectorAll('.heart-button');

    heartButtons.forEach(function(button) {
        button.addEventListener('click', function() {
            // Récupérer l'ID de la voiture à partir de l'attribut data-car-id
            var carId = this.getAttribute('data-car-id');

            // Assurez-vous que l'ID de la voiture a été récupéré avec succès
            if (carId) {
                // Déterminer si la voiture est actuellement dans les favoris en vérifiant la source de l'image
                var isFavorite = this.querySelector('img').getAttribute('src') === "{{ asset('../assets/images/coeurPlein.png') }}";

                // Définir l'URL en fonction de l'état actuel des favoris
                var url = isFavorite ? removeFromFavoritesUrl : addToFavoritesUrl;

                // Effectuer une requête AJAX pour ajouter ou retirer la voiture des favoris
                fetch(url.replace('CAR_ID', carId), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    credentials: 'same-origin',
                })
                .then(function(response) {
                    // Vérifiez si la requête a réussi
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    // Analysez la réponse JSON
                    return response.json();
                })
                .then(function(data) {
                    // Mettre à jour l'icône du cœur et le message d'alt en fonction de la réponse
                    var heartIcon = button.querySelector('img');
                    if (data.success) {
                        if (isFavorite) {
                            // La voiture a été retirée des favoris
                            heartIcon.setAttribute('src', "{{ asset('../assets/images/coeurVide.png') }}");
                            heartIcon.alt = "Coeur vide";
                        } else {
                            // La voiture a été ajoutée aux favoris
                            heartIcon.setAttribute('src', "{{ asset('../assets/images/coeurPlein.png') }}");
                            heartIcon.alt = "Coeur plein";
                        }
                    } else {
                        // Afficher un message d'erreur ou de succès si nécessaire
                    }
                })
                .catch(function(error) {
                    // Gérer les erreurs
                    console.error('There was a problem with the fetch operation:', error);
                });
            } else {
                console.error('Car id is missing from the heart button');
            }
        });
        
    });
</script>
{% endblock %}